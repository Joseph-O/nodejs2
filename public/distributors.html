<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distributor Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .nav {
            margin-bottom: 20px;
        }
        .nav a {
            margin-right: 15px;
            text-decoration: none;
            color: #0066cc;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .coverage-areas {
            margin-bottom: 10px;
        }
        .coverage-area {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        button.remove {
            background-color: #dc3545;
        }
        button.remove:hover {
            background-color: #c82333;
        }
        #distributorList {
            margin-top: 20px;
        }
        .distributor-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="nav">
        <a href="/">Users</a>
        <a href="/customers.html">Customers</a>
        <a href="/distributors.html">Distributors</a>
        <a href="/computers.html">Computers</a>
    </div>

    <h1>Distributor Management</h1>
    
    <div id="distributorForm">
        <h2>Add New Distributor</h2>
        <div class="form-group">
            <label for="name">Distributor Name:</label>
            <input type="text" id="name" required>
        </div>
        <div class="form-group">
            <label for="street">Street Address:</label>
            <input type="text" id="street" required>
        </div>
        <div class="form-group">
            <label for="city">City:</label>
            <input type="text" id="city" required>
        </div>
        <div class="form-group">
            <label for="state">State: (Optional)</label>
            <input type="text" id="state">
        </div>
        <div class="form-group">
            <label for="zipCode">Zip Code: (Optional)</label>
            <input type="text" id="zipCode">
        </div>
        <div class="form-group">
            <label for="phone">Phone: (Optional)</label>
            <input type="tel" id="phone">
        </div>
        <div class="form-group">
            <label for="email">Email: (Optional)</label>
            <input type="email" id="email">
        </div>
        <div class="form-group">
            <label for="contactPerson">Contact Person: (Optional)</label>
            <input type="text" id="contactPerson">
        </div>
        <div class="form-group">
            <label>Coverage Areas: (Optional)</label>
            <div id="coverageAreas" class="coverage-areas">
                <div class="coverage-area">
                    <input type="text" placeholder="Enter coverage area">
                    <button type="button" class="remove" onclick="removeArea(this)">Remove</button>
                </div>
            </div>
            <button type="button" onclick="addCoverageArea()">Add Coverage Area</button>
        </div>
        <div class="form-group">
            <label for="radius">Coverage Radius (km):</label>
            <input type="number" id="radius" min="0">
        </div>
        <button onclick="createDistributor()">Add Distributor</button>
    </div>

    <div id="distributorList">
        <h2>Distributor List</h2>
        <div id="distributors"></div>
    </div>

    <script>
        // Load distributors when the page loads
        document.addEventListener('DOMContentLoaded', loadDistributors);

        function addCoverageArea() {
            const coverageAreas = document.getElementById('coverageAreas');
            const newArea = document.createElement('div');
            newArea.className = 'coverage-area';
            newArea.innerHTML = `
                <input type="text" placeholder="Enter coverage area">
                <button type="button" class="remove" onclick="removeArea(this)">Remove</button>
            `;
            coverageAreas.appendChild(newArea);
        }

        function removeArea(button) {
            button.parentElement.remove();
        }

        function createDistributor() {
            const name = document.getElementById('name').value;
            const street = document.getElementById('street').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;
            const zipCode = document.getElementById('zipCode').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const contactPerson = document.getElementById('contactPerson').value;
            const radius = document.getElementById('radius').value;

            const areas = Array.from(document.querySelectorAll('#coverageAreas input'))
                .map(input => input.value)
                .filter(value => value.trim() !== '');

            if (!name || !street || !city) {
                alert('Please fill in the required fields (Name, Street, and City)');
                return;
            }

            const distributorData = {
                name,
                address: {
                    street,
                    city,
                    state,
                    zipCode
                },
                contact: {
                    phone,
                    email: email || undefined,
                    contactPerson
                },
                coverage: {
                    areas,
                    radius: radius || undefined
                }
            };

            fetch('/api/distributors', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(distributorData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to create distributor');
                }
                return response.json();
            })
            .then(() => {
                // Clear form
                document.getElementById('name').value = '';
                document.getElementById('street').value = '';
                document.getElementById('city').value = '';
                document.getElementById('state').value = '';
                document.getElementById('zipCode').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('email').value = '';
                document.getElementById('contactPerson').value = '';
                document.getElementById('radius').value = '';
                document.getElementById('coverageAreas').innerHTML = `
                    <div class="coverage-area">
                        <input type="text" placeholder="Enter coverage area">
                        <button type="button" class="remove" onclick="removeArea(this)">Remove</button>
                    </div>
                `;
                loadDistributors();
            })
            .catch(error => {
                alert('Error: ' + error.message);
            });
        }

        function loadDistributors() {
            fetch('/api/distributors')
                .then(response => response.json())
                .then(distributors => {
                    const distributorsDiv = document.getElementById('distributors');
                    distributorsDiv.innerHTML = '';
                    
                    distributors.forEach(distributor => {
                        const distributorCard = document.createElement('div');
                        distributorCard.className = 'distributor-card';
                        distributorCard.innerHTML = `
                            <strong>Name:</strong> ${distributor.name}<br>
                            <strong>Address:</strong> ${distributor.address.street}, ${distributor.address.city}
                            ${distributor.address.state ? `, ${distributor.address.state}` : ''}
                            ${distributor.address.zipCode ? ` ${distributor.address.zipCode}` : ''}<br>
                            ${distributor.contact.phone ? `<strong>Phone:</strong> ${distributor.contact.phone}<br>` : ''}
                            ${distributor.contact.email ? `<strong>Email:</strong> ${distributor.contact.email}<br>` : ''}
                            ${distributor.contact.contactPerson ? `<strong>Contact Person:</strong> ${distributor.contact.contactPerson}<br>` : ''}
                            ${distributor.coverage.areas.length > 0 ? `<strong>Coverage Areas:</strong> ${distributor.coverage.areas.join(', ')}<br>` : ''}
                            ${distributor.coverage.radius ? `<strong>Coverage Radius:</strong> ${distributor.coverage.radius} km<br>` : ''}
                            <strong>Created:</strong> ${new Date(distributor.createdAt).toLocaleString()}
                        `;
                        distributorsDiv.appendChild(distributorCard);
                    });
                })
                .catch(error => {
                    console.error('Error loading distributors:', error);
                });
        }
    </script>
</body>
</html>
